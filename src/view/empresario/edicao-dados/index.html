<!doctype html>
<html lang="pt-br">
  <!--@charset "UTF-8";/*!
  * Bootstrap v5.1.3 (https://getbootstrap.com/)
  * Copyright 2011-2021 The Bootstrap Authors
  * Copyright 2011-2021 Twitter, Inc.
  * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)-->
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Empresário - Edição Dados</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/button.css">
    <link rel="stylesheet" href="css/dashboard.css"/>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
</head>

<body>
  <header class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0 shadow">
    <a class="navbar-brand col-md-3 col-lg-2 me-0 px-3" href="/"><svg xmlns="http://www.w3.org/2000/svg" width="29" height="29" fill="currentColor" class="bi-bi-grid-fill" viewBox="0 0 16 16">
      <path d="M1 2.5A1.5 1.5 0 0 1 2.5 1h3A1.5 1.5 0 0 1 7 2.5v3A1.5 1.5 0 0 1 5.5 7h-3A1.5 1.5 0 0 1 1 5.5v-3zm8 0A1.5 1.5 0 0 1 10.5 1h3A1.5 1.5 0 0 1 15 2.5v3A1.5 1.5 0 0 1 13.5 7h-3A1.5 1.5 0 0 1 9 5.5v-3zm-8 8A1.5 1.5 0 0 1 2.5 9h3A1.5 1.5 0 0 1 7 10.5v3A1.5 1.5 0 0 1 5.5 15h-3A1.5 1.5 0 0 1 1 13.5v-3zm8 0A1.5 1.5 0 0 1 10.5 9h3a1.5 1.5 0 0 1 1.5 1.5v3a1.5 1.5 0 0 1-1.5 1.5h-3A1.5 1.5 0 0 1 9 13.5v-3z"/>
    </svg>Multilojas</a>
    <button class="navbar-toggler position-absolute d-md-none collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#sidebarMenu" aria-controls="sidebarMenu" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="navbar-nav">
      <div class="nav-item text-nowrap">
        <a class="nav-link px-3" href="/empresario/login/exit">Sair</a>
      </div>
    </div>
  </header>
  
  <div class="container-md">
    <div class="row">
      <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block sidebar collapse" style="background-color: rgba(39,61,102);">
        <div class="position-sticky pt-3">
          <ul class="nav flex-column">
            <li class="nav-item">
              <a class="nav-link" aria-current="page" href="/empresario/">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="26" fill="currentColor" class="bi bi-columns-gap" viewBox="0 0 16 16">
                  <path d="M6 1v3H1V1h5zM1 0a1 1 0 0 0-1 1v3a1 1 0 0 0 1 1h5a1 1 0 0 0 1-1V1a1 1 0 0 0-1-1H1zm14 12v3h-5v-3h5zm-5-1a1 1 0 0 0-1 1v3a1 1 0 0 0 1 1h5a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1h-5zM6 8v7H1V8h5zM1 7a1 1 0 0 0-1 1v7a1 1 0 0 0 1 1h5a1 1 0 0 0 1-1V8a1 1 0 0 0-1-1H1zm14-6v7h-5V1h5zm-5-1a1 1 0 0 0-1 1v7a1 1 0 0 0 1 1h5a1 1 0 0 0 1-1V1a1 1 0 0 0-1-1h-5z"/>
            </svg>
            <span class="links_name">Dashboard</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="/empresario/edicao-dados/">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="currentColor" class="bi bi-person" viewBox="0 0 16 16">
                  <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10z"/>
                </svg>
            <span class="links_name">Dados</span>
              </a>
            </li>
            <li class="nav-item" id="id_loja_href"></li>
            <a class="nav-link" href="/empresario/loja/edicao">
              <svg xmlns="http://www.w3.org/2000/svg" width="28" height="26" fill="currentColor" class="bi bi-apple" viewBox="0 0 16 16">
                <path d="M11.182.008C11.148-.03 9.923.023 8.857 1.18c-1.066 1.156-.902 2.482-.878 2.516.024.034 1.52.087 2.475-1.258.955-1.345.762-2.391.728-2.43zm3.314 11.733c-.048-.096-2.325-1.234-2.113-3.422.212-2.189 1.675-2.789 1.698-2.854.023-.065-.597-.79-1.254-1.157a3.692 3.692 0 0 0-1.563-.434c-.108-.003-.483-.095-1.254.116-.508.139-1.653.589-1.968.607-.316.018-1.256-.522-2.267-.665-.647-.125-1.333.131-1.824.328-.49.196-1.422.754-2.074 2.237-.652 1.482-.311 3.83-.067 4.56.244.729.625 1.924 1.273 2.796.576.984 1.34 1.667 1.659 1.899.319.232 1.219.386 1.843.067.502-.308 1.408-.485 1.766-.472.357.013 1.061.154 1.782.539.571.197 1.111.115 1.652-.105.541-.221 1.324-1.059 2.238-2.758.347-.79.505-1.217.473-1.282z"/>
                <path d="M11.182.008C11.148-.03 9.923.023 8.857 1.18c-1.066 1.156-.902 2.482-.878 2.516.024.034 1.52.087 2.475-1.258.955-1.345.762-2.391.728-2.43zm3.314 11.733c-.048-.096-2.325-1.234-2.113-3.422.212-2.189 1.675-2.789 1.698-2.854.023-.065-.597-.79-1.254-1.157a3.692 3.692 0 0 0-1.563-.434c-.108-.003-.483-.095-1.254.116-.508.139-1.653.589-1.968.607-.316.018-1.256-.522-2.267-.665-.647-.125-1.333.131-1.824.328-.49.196-1.422.754-2.074 2.237-.652 1.482-.311 3.83-.067 4.56.244.729.625 1.924 1.273 2.796.576.984 1.34 1.667 1.659 1.899.319.232 1.219.386 1.843.067.502-.308 1.408-.485 1.766-.472.357.013 1.061.154 1.782.539.571.197 1.111.115 1.652-.105.541-.221 1.324-1.059 2.238-2.758.347-.79.505-1.217.473-1.282z"/>
              </svg>
              <span class="links_name">Editar Loja</span>
            </a>
            <li class="nav-item">
              <a class="nav-link" href="/empresario/produto/cadastro/">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="26" fill="currentColor" class="bi bi-cart" viewBox="0 0 16 16">
                  <path d="M0 1.5A.5.5 0 0 1 .5 1H2a.5.5 0 0 1 .485.379L2.89 3H14.5a.5.5 0 0 1 .491.592l-1.5 8A.5.5 0 0 1 13 12H4a.5.5 0 0 1-.491-.408L2.01 3.607 1.61 2H.5a.5.5 0 0 1-.5-.5zM3.102 4l1.313 7h8.17l1.313-7H3.102zM5 12a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm7 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm-7 1a1 1 0 1 1 0 2 1 1 0 0 1 0-2zm7 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
                </svg>
              <span class="links_name">Produto</span>
              </a>
            </li>
          </ul>
        </div>
      </nav>
      </div>
      </div>
    <div class="user_content">
    <div class="form-signin">
      <div class="title text-center">
        <h2 style="color: rgb(22, 88, 126); font-weight:700;">Editar Dados</h2>
    </div>
      <div id="form_load"></div>
      <div id="erro_mensage"></div>
    </div>
</div>
<hr>
<footer class="py-3 my-4">
  <nav class="navbar navbar-expand-lg aria-label Twelfth navbar example"></nav>
    <ul class="nav justify-content-center border-bottom pb-3 mb-3" style="color: white;">
      <li class="nav-item" style="cursor: pointer;"><a href="/" class="nav-link px-2">Home</a></li>
      <li class="nav-item" style ="cursor: pointer;"><a href="/#contato" class="nav-link px-2" >Contato</a></li>
      <li class="nav-item" style="cursor: pointer;"><a href="/empresario/login" class="nav-link px-2">Login</a></li>
      <li class="nav-item" style="cursor: pointer;"><a href="/#sobre" class="nav-link px-2">Sobre</a></li>
    </ul>
    <p class="text-center text-muted">&copy; 2021-2022 Multilojas</p>
</footer>

<!--Modal Delete-->

<div class="modal fade" id="ModalDelete" tabindex="-1" aria-labelledby="ModalDeleteLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="ModalDeleteLabel">Fazer alterações?</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button onclick="deletarConta()" class="btn btn-danger">Excluir Conta</button>
      </div>
    </div>
  </div>
</div>

</body>

<script>
  checkLogin()
  async function checkLogin() {
    const url = '/empresario/login/verify';
    
    const result = await (await fetch(url)).json();
    if(result.status == 0){
      consultDados(result.info.id);
      id_loja_href(result.info.id);
    } else {
      location.href= "/empresario/login";
    }
  }

  async function id_loja_href(id){
    let url = `/loja/possui/${id}`
    let result = await (await fetch(url)).json();

    const id_loja_href = document.querySelector('#id_loja_href');
    let view = `<a class="nav-link" href="/loja/${result.loja}">
      <svg xmlns="http://www.w3.org/2000/svg" width="28" height="26" fill="currentColor" class="bi bi-apple" viewBox="0 0 16 16">
        <path d="M11.182.008C11.148-.03 9.923.023 8.857 1.18c-1.066 1.156-.902 2.482-.878 2.516.024.034 1.52.087 2.475-1.258.955-1.345.762-2.391.728-2.43zm3.314 11.733c-.048-.096-2.325-1.234-2.113-3.422.212-2.189 1.675-2.789 1.698-2.854.023-.065-.597-.79-1.254-1.157a3.692 3.692 0 0 0-1.563-.434c-.108-.003-.483-.095-1.254.116-.508.139-1.653.589-1.968.607-.316.018-1.256-.522-2.267-.665-.647-.125-1.333.131-1.824.328-.49.196-1.422.754-2.074 2.237-.652 1.482-.311 3.83-.067 4.56.244.729.625 1.924 1.273 2.796.576.984 1.34 1.667 1.659 1.899.319.232 1.219.386 1.843.067.502-.308 1.408-.485 1.766-.472.357.013 1.061.154 1.782.539.571.197 1.111.115 1.652-.105.541-.221 1.324-1.059 2.238-2.758.347-.79.505-1.217.473-1.282z"/>
        <path d="M11.182.008C11.148-.03 9.923.023 8.857 1.18c-1.066 1.156-.902 2.482-.878 2.516.024.034 1.52.087 2.475-1.258.955-1.345.762-2.391.728-2.43zm3.314 11.733c-.048-.096-2.325-1.234-2.113-3.422.212-2.189 1.675-2.789 1.698-2.854.023-.065-.597-.79-1.254-1.157a3.692 3.692 0 0 0-1.563-.434c-.108-.003-.483-.095-1.254.116-.508.139-1.653.589-1.968.607-.316.018-1.256-.522-2.267-.665-.647-.125-1.333.131-1.824.328-.49.196-1.422.754-2.074 2.237-.652 1.482-.311 3.83-.067 4.56.244.729.625 1.924 1.273 2.796.576.984 1.34 1.667 1.659 1.899.319.232 1.219.386 1.843.067.502-.308 1.408-.485 1.766-.472.357.013 1.061.154 1.782.539.571.197 1.111.115 1.652-.105.541-.221 1.324-1.059 2.238-2.758.347-.79.505-1.217.473-1.282z"/>
      </svg>
      <span class="links_name">Loja</span>
    </a>`
    id_loja_href.insertAdjacentHTML('beforeend', view);
  }

  function createView(dados){
    const form = document.querySelector('#form_load');
    view = `
      <label><b>ID: #${dados.id_empresario}</b></label>
        <form>
          <!--Botão para adicionar modal-->

        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil-square" viewBox="0 0 16 16">
            <path style="color: white;" d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>
            <path  style="color: white;" fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"/>
          </svg>
        </button>

          <!--Modal-->

          <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="exampleModalLabel">Fazer alterações?</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-footer">
                  <button class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                  <button onclick="save()" class="btn btn-primary">Salvar mudanças</button>
                </div>
              </div>
            </div>
          </div>

          <div class="form-floating">
            <center><a for="name">Nome Completo </a></center>
            <input type="text" id="name" value="${dados.nome}" class="form-control" placeholder="Nome completo">
          </div>
          <div class="form-floating">
            <center><a for="email">Email </a>
            </center>
            <input type="email" id="email" value="${dados.email}" class="form-control" placeholder="name@example.com">
          </div>
          <div class="form-floating"><center>
            <a for="telefone"> Telefone </a></center>
            <input type="text" id="telefone" value="${dados.telefone}" class="form-control" placeholder="(DDD) XXXXX-XXXX">
          </div>
          <div class="form-floating"><center>
            <a for="senha">Senha</a></center>
            <input type="password" id="senha" class="form-control" placeholder="password">
          </div>

        <div class="delete">
            <label>
            <button type="button" data-bs-toggle="modal" data-bs-target="#ModalDelete" class="btn btn-danger" style="width: 120px; height:50px">Deletar</button>
            </label>
        </div>
        
        </form>`
    form.insertAdjacentHTML('beforeend', view);
  }

  async function consultDados(id) {
    const url = `/empresario/dados/${id}`;
    
    const result = await (await fetch(url)).json();
    createView(result);
  }
  
  const form_main = document.querySelector('form');
    
  async function save() {
    const url = '/empresario/login/verify';
    
    const result = await (await fetch(url)).json();
    const id_empresário = result.info.id;

    let name = document.querySelector("#name");
    let email = document.querySelector("#email");
    let telefone = document.querySelector("#telefone");
    let senha = document.querySelector("#senha");
    
    const dados = Object.fromEntries(new FormData());

    dados["nome"] = name.value;
    dados["email"] = email.value;
    dados["telefone"] = telefone.value;
    dados["senha"] = senha.value;
    dados["id_empresario"] = id_empresário;
    editAccount(dados);
  }

  async function editAccount(dados) {
    const url = '/empresario/dados/edit';
    
    const config = {
      method: 'put',
      body: JSON.stringify(dados),
      headers: {
        'Content-Type': 'application/json; charset=UTF-8',
      },
    };

    await (await fetch(url, config)).json();
  }

  async function deletarConta() {
    const erro_mensage = document.querySelector('#erro_mensage');
    const url = '/empresario/login/verify';
    
    const result = await (await fetch(url)).json();
    const id_empresario = result.info.id;

    const url2 = `/empresario/dados/delete/${id_empresario}`;

    const config = {
      method: 'delete',
      headers: {
        'Content-Type': 'application/json; charset=UTF-8',
      },
    };

    const result2 = await (await fetch(url2,config)).json();
    if(result2.status == 1){
      location.href= "/empresario/login/exit";
    } else {
      let view = `<div class="alert alert-danger alert-dismissible fade show" role="alert">
            <strong>Aviso: </strong>Não foi possível Deletar sua Conta
        </div>`
      erro_mensage.insertAdjacentHTML('beforeend', view);
    }
  }

</script>

</html>