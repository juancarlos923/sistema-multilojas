<!DOCTYPE html>
<html lang="pt-BR">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>Empresário - Dashboard</title>
        <link rel="icon" type="image/x-icon" href="./painel/assets/img/favicon.ico" />

        <link href="./painel/css/style1.css" rel="stylesheet" />
        <link href="./painel/css/style2.css" rel="stylesheet" />
        <script src="./painel/js/script.js"></script>
        <!-- CSS (includes Bootstrap)-->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" />
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"></script>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
        <!-- icones -->
        <link href="https://cdn.jsdelivr.net/npm/boxicons@latest/css/boxicons.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
    </head>


<!DOCTYPE html>
    <html lang="pt-BR">
    <head>
        <link rel="icon" type="image/x-icon" href="./painel/assets/img/favicon.ico" />
        <link href="./painel/css/style1.css" rel="stylesheet" />
        <link href="css/style2.css" rel="stylesheet" />
        <script src="./painel/js/script.js"></script>
        <!-- CSS (includes Bootstrap)-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"></script>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
        <!-- icones -->
        <link href="https://cdn.jsdelivr.net/npm/boxicons@latest/css/boxicons.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
    </head>


    <!DOCTYPE html>
    <html lang="pt-BR">
        <head>
            <link rel="icon" type="image/x-icon" href="assets/img/favicon.ico" />
    
            <link href="./painel/css/main.css" rel="stylesheet" />
            <script src="./painel/js/script.js"></script>
            <!-- CSS (includes Bootstrap)-->
            <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
            <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" />
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"></script>
            <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
            <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
            <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
            <!-- icones -->
            <link href="https://cdn.jsdelivr.net/npm/boxicons@latest/css/boxicons.min.css" rel="stylesheet">
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
        </head>
    <body id="body-pd">
        <header class="header" id="header">
            <div class="header_toggle"> <i class='bx bx-menu' id="header-toggle"></i> </div>
        </header>
    <div class="l-navbar" id="nav-bar">
        <nav class="nav">
            <div> <a href="/" class="nav_logo"> <i class='bx bx-grid-alt nav_logo-icon'></i> <span class="nav_logo-name">Sistema Multilojas</span> </a>
                <div class="nav_list">
                    <a href="/empresario" class="nav_link active">
                        <i class='bx bxs-dashboard nav_icon'></i> <!-- Icone do CSS Externo -->
                        <span class="nav_name">Dashboard</span>
                    </a>
                    <a href="/empresario/edicao-dados" class="nav_link">
                        <i class='bx bx-user nav_icon'></i> <!-- Icone do CSS Externo -->
                        <span class="nav_name">Conta</span>
                    </a>
                    <div id="id_loja_href"></div>
                    <a class="nav_link" href="/empresario/loja/edicao">
                        <i class='bx bx-store nav_icon'></i>
                        <span class="nav_name">Editar Loja</span>
                    </a>
                    <a href="/empresario/produto/cadastro/" class="nav_link">
                        <i class='bx bxs-cart nav_icon'></i> <!-- Icone do CSS Externo -->
                        <span class="nav_name">Produto</span>
                    </a>
                    </div>
                </div>
            <a href="" class="nav_link" data-toggle="modal" data-target="#modalExemplo">
                <i class='bx bx-log-out nav_icon'></i>
                <span class="nav_name">Sair</span>
            </a>
        </nav>
    </div>
        <br><br><br>
    <div id="verify_loja"></div>
    <div id="produtos"></div>

    <div id="dados_vendas"></div>
        
        
        <!-- Modal de Deslogar -->
        <div class="modal fade" id="modalExemplo" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Logout</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    </div>
                    <div class="modal-body">
                    Tem certeza que quer Sair?
                    </div>
                    <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="window.location.href='http://localhost:3000/empresario/login/exit'">Sair</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Modal de Editar Produto Dados -->
        <div class="modal fade" id="modalEditProduto" tabindex="-1" role="dialog" aria-labelledby="modalEditProdutoLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                    <h5 class="modal-title" id="modalEditProdutoLabel">Selecione o Produto e Atualize os Dados</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    </div>
                    <div class="modal-body">
                        
                        <form>

                            <div class="col-6">
                                <a for="floatingInput">Produto a ser Atualizado</a>
                                <select class="form-select" name="id_produto" id="name_produto">
                                    <option name="id_produto" value="" selected style="color: black">Escolher</option>
                                </select>
                            </div>

                            <div class="col-12">
                                <a for="floatingInput">Nome</a>
                                <input type="text" class="form-control" name="nome" id="name">
                            </div>
                            <br>
                    
                            <div class="col-12">
                                <a for="floatingInput">Descrição</a>
                                <textarea  style="height: 80px; margin-top: 2px;" name="descricao" class="form-control" aria-label="With textarea" id="textarea"></textarea>
                            </div>
                    
                            <div class="col-4">
                                <label for="floatingInput">Preço</label>
                                <input type="number" class="form-control" name="preco" id="price" placeholder="R$">
                            </div>
                    
                            <div class="col-6">
                                <a for="floatingInput">Categoria</a>
                                <select name="categoria" class="form-select">
                                    <option value="" selected style="color: black">Escolher...</option>
                                    <option value="E-book">E-book</option>
                                    <option value="Curso">Curso</option>
                                </select>
                            </div>
                            
                            <div class="col-6">
                                <a for="floatingInput">Tipo de Entrega</a>
                                <select name="forma_entrega" class="form-select">
                                    <option value="" selected style="color: black">Escolher</option>
                                    <option value="Email">E-mail</option>
                                    <option value="Kindle">Kindle</option></label>
                                    <option value="Telefone">Telefone</option></label>
                                </select>
                            </div>
                            </div>
                            <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                            <button type="submit" class="btn btn-primary">Atualizar</button>
                            </div>
                        </form>
                </div>
            </div>
        </div>
        
        <!-- Modal de Editar Produto Foto -->
        <div class="modal fade" id="modalEditPhoto" tabindex="-1" role="dialog" aria-labelledby="modalEditPhotoLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                    <h5 class="modal-title" id="modalEditPhotoLabel">Selecione o Produto e Nova Foto</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    </div>
                    <div class="modal-body">
                        <form method='post' action='/produto/upload' enctype="multipart/form-data">
                            <div class="col-6">
                                <a for="floatingInput">Produto a ser Atualizado</a>
                                <select name="id_produto" class="form-select" id="name_produto2">
                                    <option value="" selected style="color: black">Escolher</option>
                                </select>
                            </div>

                            <div class="col-10"><br>
                                <input type="file" class="form-control" name="sampleFile" accept="image/*"/>
                            </div>

                            </div>
                            <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                            <input type="submit" class="btn btn-primary"/>
                            </div>
                        </form>
                </div>
            </div>
        </div>
    </body>

</html>

<script>
    const exibir = document.querySelector('#verify_loja');
    const vendas = document.querySelector('#dados_vendas');
    const produto = document.querySelector('#produtos');
    const form_produto = document.querySelector('#name_produto');
    const form_produto2 = document.querySelector('#name_produto2');
    const id_loja_href = document.querySelector('#id_loja_href');
    checkLogin()
    async function checkLogin() {
        const url = '/empresario/login/verify';
        const result = await (await fetch(url)).json();
        if(result.status != 0){
            location.href = "/empresario/login";
        } else {
            const url = `/loja/possui/${result.info.id}`;
            const result2 = await (await fetch(url)).json();
            if(result2.result != 1){
                view = `<h2>Você não possui loja</h2>
                <br><a href="/empresario/loja/cadastro"><h3>Aperte aqui para criar uma loja</h3></a>`
                exibir.insertAdjacentHTML('beforeend', view);
            } else {
                createViewProdutos(result2);
                let view = `
                <a class="nav_link" href="/loja/${result2.loja}">
                    <i class='bx bx-store nav_icon'></i>
                    <span class="nav_name">Loja</span>
                </a>`
                id_loja_href.insertAdjacentHTML('beforeend', view);
                createViewVendas(result2);
            }
            
        }
    }

    async function createViewProdutos(dados){
        
        const url3 = `/loja/produtos/${dados.loja}`;
        let result = await (await fetch(url3)).json();
        let view0 = ``
        for (let i = 0; i < result.length; i++) {
            view0 += `
            <option value="${result[i].id_produto}">${result[i].nome}</option>`
        }
        form_produto.insertAdjacentHTML('beforeend', view0);
        form_produto2.insertAdjacentHTML('beforeend', view0);

        const view = `
        <div class="col-lg-10 mx-auto mt-4">
        <h2 class="mb-5">Produtos da Loja   
            <a href="#" data-toggle="modal" data-target="#modalEditPhoto" class="btn btn-primary">
            <i class="fas fa-camera"></i> Editar Foto</a>
            <a href="#" data-toggle="modal" data-target="#modalEditProduto" class="btn btn-primary"><i class="fas fa-pencil-alt"></i> Editar Dados</a></h2>
        <div class="row">
            `
        let view2 = ``
        for (let i = 0; i < result.length; i++) {
            view2 += `<div class="col-md-4">
                <div class="card" style="width: 18rem;">
                    <center><img src="${result[i].imagem}" width="100" height="100" alt="Foto do Produto"></center>
                    <div class="card-body">
                        <h5 class="card-title">${result[i].nome}</h5>
                        <h6 class="card-subtitle mb-2 text-muted">${result[i].categoria} | Entrega por ${result[i].forma_entrega}</h6>
                        <p class="card-text">${result[i].descricao}</p>
                    </div>
                </div>
            </div>`
        }
        const view3 = `
            </div>
        </div>`
        
        produto.insertAdjacentHTML('beforeend', view + view2 + view3);
    }

    async function createViewVendas(dados){
        
        const url2 = `/loja/vendas/${dados.loja}`;
        let result = await (await fetch(url2)).json();
        
        const view = `
        <div class="col-lg-10 mx-auto">
            <h2 class="mb-5">Vendas</h2>
            <div class="card rounded shadow border-0">
              <div class="card-body p-5 bg-white rounded">
                <div class="table-responsive">
                  <table id="example" style="width:100%" class="table table-striped table-bordered">
                    <thead>
                        <tr>
                            <td><b>ID da Compra</b></td>
                            <td><b>Descrição</b></td>
                            <td><b>Valor</b></td>
                            <td><b>Data</b></td>
                            <td><b>Meio de Pagamento</b></td>
                            <td><b>Status de Entrega</b></td>
                            <td><b>Data & Hora</b></td>
                        </tr>
                    </thead>
                    <tbody>`
                        
        let view2 = ``
        for (let i = 0; i < result.length; i++) {
            
            view2 += "</tr>" + 
            "<td>" + result[i].id_compra + "</td>" +
            "<td>" + result[i].descricao + "</td>" +
            "<td>" + result[i].valor_total + "</td>" +
            "<td>" + result[i].forma_pagamento + "</td>" +
            "<td>" + result[i].entrega + "</td>" +
            "<td>" + result[i].status + "</td>" +
            "<td>" + result[i].data + "</td>" + "</tr>";
        }
        const view3 = `  
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>`
        vendas.insertAdjacentHTML('beforeend', view + view2 + view3);
    }

    const form = document.querySelector('form');
    const error = document.getElementById('#error');

    form.onsubmit = (event) => {
        event.preventDefault();

        const dados = Object.fromEntries(new FormData(form));
        
        updateProduto(dados);
    };

    async function updateProduto(dados) {
        const url_update = '/loja/produto/update';
        let config = {
            method: 'put',
            body: JSON.stringify(dados),
            headers: {
                'Content-Type': 'application/json; charset=UTF-8',
            },
        };
        
        const resposta = await (await fetch(url_update, config)).json();
        if(resposta.error == 0){
            location.href = "/empresario/"
        }
    }

</script>