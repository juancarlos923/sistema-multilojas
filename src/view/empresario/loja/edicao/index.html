<!doctype html>
<html lang="pt-br">
  <!--@charset "UTF-8";/*!
  * Bootstrap v5.1.3 (https://getbootstrap.com/)
  * Copyright 2011-2021 The Bootstrap Authors
  * Copyright 2011-2021 Twitter, Inc.
  * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)-->
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loja - Edição</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="dashboard.css" />
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="button.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
</head>

<body style="background: rgba(39,61,102);">
  <header class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0 shadow">
    <a class="navbar-brand col-md-3 col-lg-2 me-0 px-3" href="/"><svg xmlns="http://www.w3.org/2000/svg" width="29" height="29" fill="currentColor" class="bi-bi-grid-fill" viewBox="0 0 16 16">
      <path d="M1 2.5A1.5 1.5 0 0 1 2.5 1h3A1.5 1.5 0 0 1 7 2.5v3A1.5 1.5 0 0 1 5.5 7h-3A1.5 1.5 0 0 1 1 5.5v-3zm8 0A1.5 1.5 0 0 1 10.5 1h3A1.5 1.5 0 0 1 15 2.5v3A1.5 1.5 0 0 1 13.5 7h-3A1.5 1.5 0 0 1 9 5.5v-3zm-8 8A1.5 1.5 0 0 1 2.5 9h3A1.5 1.5 0 0 1 7 10.5v3A1.5 1.5 0 0 1 5.5 15h-3A1.5 1.5 0 0 1 1 13.5v-3zm8 0A1.5 1.5 0 0 1 10.5 9h3a1.5 1.5 0 0 1 1.5 1.5v3a1.5 1.5 0 0 1-1.5 1.5h-3A1.5 1.5 0 0 1 9 13.5v-3z"/>
    </svg>Multilojas</a>
    <button class="navbar-toggler position-absolute d-md-none collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#sidebarMenu" aria-controls="sidebarMenu" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="navbar-nav">
      <div class="nav-item text-nowrap">
        <a class="nav-link px-3" href="/empresario/login/exit">Sair</a>
      </div>
    </div>
  </header>
  
  <div class="container-md">
    <div class="row">
      <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block sidebar collapse" style="background-color: rgb(255, 255, 255);">
        <div class="position-sticky pt-3">
          <ul class="nav flex-column">
            <li class="nav-item">
              <a class="nav-link"  style="color: rgb(22, 88, 126);" aria-current="page" href="/empresario/">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="26" fill="currentColor" class="bi bi-columns-gap" viewBox="0 0 16 16">
                  <path d="M6 1v3H1V1h5zM1 0a1 1 0 0 0-1 1v3a1 1 0 0 0 1 1h5a1 1 0 0 0 1-1V1a1 1 0 0 0-1-1H1zm14 12v3h-5v-3h5zm-5-1a1 1 0 0 0-1 1v3a1 1 0 0 0 1 1h5a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1h-5zM6 8v7H1V8h5zM1 7a1 1 0 0 0-1 1v7a1 1 0 0 0 1 1h5a1 1 0 0 0 1-1V8a1 1 0 0 0-1-1H1zm14-6v7h-5V1h5zm-5-1a1 1 0 0 0-1 1v7a1 1 0 0 0 1 1h5a1 1 0 0 0 1-1V1a1 1 0 0 0-1-1h-5z"/>
            </svg>
            <span class="links_name">Dashboard</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" style="color: rgb(22, 88, 126);" aria-current="page" href="/empresario/edicao-dados/">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="currentColor" class="bi bi-person" viewBox="0 0 16 16">
                  <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10z"/>
                </svg>
            <span class="links_name">Dados</span>
              </a>
            </li>
            <div id="id_loja_href"></div>
            <li class="nav-item">
              <a class="nav-link active" href="/empresario/loja/edicao">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="26" fill="currentColor" class="bi bi-apple" viewBox="0 0 16 16">
                  <path d="M11.182.008C11.148-.03 9.923.023 8.857 1.18c-1.066 1.156-.902 2.482-.878 2.516.024.034 1.52.087 2.475-1.258.955-1.345.762-2.391.728-2.43zm3.314 11.733c-.048-.096-2.325-1.234-2.113-3.422.212-2.189 1.675-2.789 1.698-2.854.023-.065-.597-.79-1.254-1.157a3.692 3.692 0 0 0-1.563-.434c-.108-.003-.483-.095-1.254.116-.508.139-1.653.589-1.968.607-.316.018-1.256-.522-2.267-.665-.647-.125-1.333.131-1.824.328-.49.196-1.422.754-2.074 2.237-.652 1.482-.311 3.83-.067 4.56.244.729.625 1.924 1.273 2.796.576.984 1.34 1.667 1.659 1.899.319.232 1.219.386 1.843.067.502-.308 1.408-.485 1.766-.472.357.013 1.061.154 1.782.539.571.197 1.111.115 1.652-.105.541-.221 1.324-1.059 2.238-2.758.347-.79.505-1.217.473-1.282z"/>
                  <path d="M11.182.008C11.148-.03 9.923.023 8.857 1.18c-1.066 1.156-.902 2.482-.878 2.516.024.034 1.52.087 2.475-1.258.955-1.345.762-2.391.728-2.43zm3.314 11.733c-.048-.096-2.325-1.234-2.113-3.422.212-2.189 1.675-2.789 1.698-2.854.023-.065-.597-.79-1.254-1.157a3.692 3.692 0 0 0-1.563-.434c-.108-.003-.483-.095-1.254.116-.508.139-1.653.589-1.968.607-.316.018-1.256-.522-2.267-.665-.647-.125-1.333.131-1.824.328-.49.196-1.422.754-2.074 2.237-.652 1.482-.311 3.83-.067 4.56.244.729.625 1.924 1.273 2.796.576.984 1.34 1.667 1.659 1.899.319.232 1.219.386 1.843.067.502-.308 1.408-.485 1.766-.472.357.013 1.061.154 1.782.539.571.197 1.111.115 1.652-.105.541-.221 1.324-1.059 2.238-2.758.347-.79.505-1.217.473-1.282z"/>
                </svg>
              <span class="links_name">Editar Loja</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link"  style="color: rgb(22, 88, 126);" href="/empresario/produto/cadastro">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="26" fill="currentColor" class="bi bi-cart" viewBox="0 0 16 16">
                  <path d="M0 1.5A.5.5 0 0 1 .5 1H2a.5.5 0 0 1 .485.379L2.89 3H14.5a.5.5 0 0 1 .491.592l-1.5 8A.5.5 0 0 1 13 12H4a.5.5 0 0 1-.491-.408L2.01 3.607 1.61 2H.5a.5.5 0 0 1-.5-.5zM3.102 4l1.313 7h8.17l1.313-7H3.102zM5 12a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm7 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm-7 1a1 1 0 1 1 0 2 1 1 0 0 1 0-2zm7 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
                </svg>
              <span class="links_name">Produto</span>
              </a>
            </li>
          </ul>
        </div>
      </nav>
      </div>
      </div>
<div class="user_content">
    <div class="form-signin">
      <div class="title text-center">
        <h2 style="color: rgb(255, 255, 255); font-weight:700;">Editar Dados da Loja</h2>
    </div>
    <div id="form_load"></div>
    <div id="erro_mensage"></div>
    </div>
</div>
<footer class="py-3 my-4">
  <nav class="navbar navbar-expand-lg aria-label Twelfth navbar example"></nav>
    <ul class="nav justify-content-center border-bottom pb-3 mb-3" style="color: white;">
      <li class="nav-item" style="cursor: pointer;"><a href="../index/index.html" class="nav-link px-2">Home</a></li>
      <li class="nav-item" style ="cursor: pointer;"><a href="../index/index.html" class="nav-link px-2" >Contato</a></li>
      <li class="nav-item" style="cursor: pointer;"><a href="../login/index.html" class="nav-link px-2">Login</a></li>
      <li class="nav-item" style="cursor: pointer;"><a href="../index/index.html" class="nav-link px-2">Sobre</a></li>
    </ul>
    <p class="text-center text-muted">&copy; 2021-2022 Multilojas</p>
</footer>

<!--Modal Delete-->

<div class="modal fade" id="ModalDelete" tabindex="-1" aria-labelledby="ModalDeleteLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="ModalDeleteLabel">Fazer alterações?</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button onclick="deletarLoja()" class="btn btn-danger">Excluir Loja</button>
      </div>
    </div>
  </div>
</div>

</body>

<script>
  checkLogin()
  async function checkLogin() {
    const url = '/empresario/login/verify';
    
    const result = await (await fetch(url)).json();
    if(result.status == 0){
      consultDados(result.info.id);
      id_loja_href(result.info.id);
    } else {
      location.href= "/empresario/login";
    }
  }

  async function id_loja_href(id){
    let url = `/loja/possui/${id}`
    let result = await (await fetch(url)).json();

    const id_loja_href = document.querySelector('#id_loja_href');
    let view = `
    <li class="nav-item">
      <a class="nav-link" style="color: rgb(22, 88, 126);" href="/loja/${result.loja}">
        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="26" fill="currentColor" class="bi bi-apple" viewBox="0 0 16 16">
          <path d="M11.182.008C11.148-.03 9.923.023 8.857 1.18c-1.066 1.156-.902 2.482-.878 2.516.024.034 1.52.087 2.475-1.258.955-1.345.762-2.391.728-2.43zm3.314 11.733c-.048-.096-2.325-1.234-2.113-3.422.212-2.189 1.675-2.789 1.698-2.854.023-.065-.597-.79-1.254-1.157a3.692 3.692 0 0 0-1.563-.434c-.108-.003-.483-.095-1.254.116-.508.139-1.653.589-1.968.607-.316.018-1.256-.522-2.267-.665-.647-.125-1.333.131-1.824.328-.49.196-1.422.754-2.074 2.237-.652 1.482-.311 3.83-.067 4.56.244.729.625 1.924 1.273 2.796.576.984 1.34 1.667 1.659 1.899.319.232 1.219.386 1.843.067.502-.308 1.408-.485 1.766-.472.357.013 1.061.154 1.782.539.571.197 1.111.115 1.652-.105.541-.221 1.324-1.059 2.238-2.758.347-.79.505-1.217.473-1.282z"/>
          <path d="M11.182.008C11.148-.03 9.923.023 8.857 1.18c-1.066 1.156-.902 2.482-.878 2.516.024.034 1.52.087 2.475-1.258.955-1.345.762-2.391.728-2.43zm3.314 11.733c-.048-.096-2.325-1.234-2.113-3.422.212-2.189 1.675-2.789 1.698-2.854.023-.065-.597-.79-1.254-1.157a3.692 3.692 0 0 0-1.563-.434c-.108-.003-.483-.095-1.254.116-.508.139-1.653.589-1.968.607-.316.018-1.256-.522-2.267-.665-.647-.125-1.333.131-1.824.328-.49.196-1.422.754-2.074 2.237-.652 1.482-.311 3.83-.067 4.56.244.729.625 1.924 1.273 2.796.576.984 1.34 1.667 1.659 1.899.319.232 1.219.386 1.843.067.502-.308 1.408-.485 1.766-.472.357.013 1.061.154 1.782.539.571.197 1.111.115 1.652-.105.541-.221 1.324-1.059 2.238-2.758.347-.79.505-1.217.473-1.282z"/>
        </svg>
      <span class="links_name">Loja</span>
      </a>
    </li>
    `
    id_loja_href.insertAdjacentHTML('beforeend', view);
  }

  async function consultDados(id) {
    let url = `/loja/possui/${id}`;
    let result = await (await fetch(url)).json();
    
    let url2 = `/loja/info/${result.loja}`
    let result2 = await (await fetch(url2)).json();

    if(result2.result == 0){
      location.href= "/empresario/login";
    } else {
      createView(result2);
    }
    
  }

  function createView(dados){
    const form2 = document.querySelector('#form_load');
    
    view = `
    <form>
      <label style="color:white"><b>ID: #${dados.id_empresario}</b></label><br>
      <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil-square" viewBox="0 0 16 16">
          <path style="color: white;" d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>
          <path  style="color: white;" fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"/>
        </svg>
      </button>

      <!--Modal-->

      <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">Fazer alterações?</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
              <button type="button" onclick="save()" class="btn btn-primary">Salvar mudanças</button>
            </div>
          </div>
        </div>
      </div>

      <div class="form-floating">
        <center><a for="nome" style="color:white" >Nome da Loja</a></center>
        <input type="text" class="form-control" value="${dados.nome}" id="nome">
      </div>
      <div class="form-floating">
        <center><a for="CNPJ" style="color:white">CNPJ</a></center>
        <input type="text" class="form-control"value="${dados.cnpj}" id="CNPJ">
      </div>
      <div class="form-floating"><center>
        <a for="telefone" style="color:white">Telefone</a></center>
        <input type="text" class="form-control" onkeypress="mask(this, mphone);" value="${dados.telefone}" id="telefone">
      </div>
      <div class="form-floating"><center>
        <a for="descricao" style="color:white">Descrição</a></center>
        <input type="text" class="form-control" value="${dados.descricao}" id="descricao" maxlength="18" aria-label="With textarea">
      </div>
      <div class="form-floating"><center>
        <a for="descricao" style="color:white">Termos</a></center>
        <input type="text" class="form-control" value="${dados.termos}" id="termos" aria-label="With textarea">
      </div>
    <hr class="my-4">
      <div class="delete">
        <label>
          <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#ModalDelete" style="width: 120px; height:50px">Deletar</button>
      </label>
      </div>
    </form>`
    form2.insertAdjacentHTML('beforeend', view);
  }

  async function save() {
    let url = '/empresario/login/verify';
    let result = await (await fetch(url)).json();

    let id_empresario = result.info.id;

    let nome = document.querySelector("#nome");
    let cnpj = document.querySelector("#CNPJ");
    let telefone = document.querySelector("#telefone");
    let descricao = document.querySelector("#descricao");
    let termos = document.querySelector("#termos");
    
    const dados = Object.fromEntries(new FormData());

    dados["nome"] = nome.value;
    dados["CNPJ"] = cnpj.value;
    dados["telefone"] = telefone.value;
    dados["descricao"] = descricao.value;
    dados["termos"] = termos.value;
    dados["id_empresario"] = id_empresario;
    
    editAccount(dados);
  }

  async function editAccount(dados) {
    const url = '/loja/dados/edit';
    
    const config = {
      method: 'put',
      body: JSON.stringify(dados),
      headers: {
        'Content-Type': 'application/json; charset=UTF-8',
      },
    };

    let resposta = await (await fetch(url, config)).json();
    if(resposta.error == 0){
      window.location.reload()
    }
  }

  async function deletarLoja() {
    const erro_mensage = document.querySelector('#erro_mensage');
    const url = '/empresario/login/verify';
    
    const result = await (await fetch(url)).json();
    const id_empresario = result.info.id;

    const url2 = `/loja/dados/delete/${id_empresario}`;

    const config = {
      method: 'delete',
      headers: {
        'Content-Type': 'application/json; charset=UTF-8',
      },
    };

    const result2 = await (await fetch(url2,config)).json();
    if(result2.status == 1){
      location.href= "/empresario/";
    } else {
      let view = `<div class="alert alert-danger alert-dismissible fade show" role="alert">
            <strong>Aviso: </strong>Não foi possível Deletar sua Conta
        </div>`
      erro_mensage.insertAdjacentHTML('beforeend', view);
    }
  }

  function mask(o, f) { // Máscara Telefone
    setTimeout(function() {
      var v = mphone(o.value);
      if (v != o.value) {
        o.value = v;
      }
    }, 1);
  }

  function mphone(v) { // Máscara Telefone
    var r = v.replace(/\D/g, "");
    r = r.replace(/^0/, "");
    if (r.length > 10) {
      r = r.replace(/^(\d\d)(\d{5})(\d{4}).*/, "($1) $2-$3");
    } else if (r.length > 5) {
      r = r.replace(/^(\d\d)(\d{4})(\d{0,4}).*/, "($1) $2-$3");
    } else if (r.length > 2) {
      r = r.replace(/^(\d\d)(\d{0,5})/, "($1) $2");
    } else {
      r = r.replace(/^(\d*)/, "($1");
    }
    return r;
  }

</script>

</html>
